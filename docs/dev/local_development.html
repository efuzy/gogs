<!DOCTYPE html>
<html>
<head>
<title>local_development.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="getting-started-with-developing-gogs">Getting started with developing Gogs</h1>
<blockquote>
<p>This document is driven from https://docs.sourcegraph.com/dev/local_development.</p>
</blockquote>
<p>Gogs is written in <a href="https://golang.org/">Go</a>, please take <a href="https://tour.golang.org/">A Tour of Go</a> if you haven't done so!</p>
<h2 id="outline">Outline</h2>
<ul>
<li><a href="#environment">Environment</a></li>
<li><a href="#step-1-install-dependencies">Step 1: Install dependencies</a></li>
<li><a href="#step-2-initialize-your-database">Step 2: Initialize your database</a></li>
<li><a href="#step-3-get-the-code">Step 3: Get the code</a></li>
<li><a href="#step-4-configure-database-settings">Step 4: Configure database settings</a></li>
<li><a href="#step-5-start-the-server">Step 5: Start the server</a></li>
<li><a href="#other-nice-things">Other nice things</a></li>
</ul>
<h2 id="environment">Environment</h2>
<p>Gogs is built and runs as a single binary and meant to be cross platform. Therefore, you should be able to develop Gogs in any major platforms you prefer.</p>
<h2 id="step-1-install-dependencies">Step 1: Install dependencies</h2>
<p>Gogs has the following dependencies:</p>
<ul>
<li><a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git">Git</a> (v1.8.3 or higher)</li>
<li><a href="https://golang.org/doc/install">Go</a> (v1.14 or higher)</li>
<li><a href="http://lesscss.org/usage/#command-line-usage-installing">Less.js</a></li>
<li><a href="https://www.gnu.org/software/make/">GNU Make</a></li>
<li>Database upon your choice (pick one, we choose PostgreSQL in this document):
<ul>
<li><a href="https://wiki.postgresql.org/wiki/Detailed_installation_guides">PostgreSQL</a> (v9.6 or higher)</li>
<li><a href="https://dev.mysql.com/downloads/mysql/">MySQL</a> with <code>ENGINE=InnoDB</code> (v5.7 or higher)</li>
<li><a href="https://www.sqlite.org/index.html">SQLite3</a></li>
<li><a href="https://github.com/pingcap/tidb">TiDB</a></li>
</ul>
</li>
</ul>
<h3 id="macos">macOS</h3>
<ol>
<li>
<p>Install <a href="https://brew.sh/">Homebrew</a>.</p>
</li>
<li>
<p>Install dependencies:</p>
<pre class="hljs"><code><div>brew install go postgresql git go-bindata npm
npm install -g less
npm install -g less-plugin-clean-css
</div></code></pre>
</li>
<li>
<p>Configure PostgreSQL to start automatically:</p>
<pre class="hljs"><code><div>brew services start postgresql
</div></code></pre>
</li>
<li>
<p>Ensure <code>psql</code>, the PostgreSQL command line client, is on your <code>$PATH</code>.
Homebrew does not put it there by default. Homebrew gives you the command to run to insert <code>psql</code> in your path in the &quot;Caveats&quot; section of <code>brew info postgresql</code>. Alternatively, you can use the command below. It might need to be adjusted depending on your Homebrew prefix (<code>/usr/local</code> below) and shell (bash below).</p>
<pre class="hljs"><code><div><span class="hljs-built_in">hash</span> psql || { <span class="hljs-built_in">echo</span> <span class="hljs-string">'export PATH="/usr/local/opt/postgresql/bin:$PATH"'</span> &gt;&gt; ~/.bash_profile }
<span class="hljs-built_in">source</span> ~/.bash_profile
</div></code></pre>
</li>
</ol>
<h3 id="ubuntu">Ubuntu</h3>
<ol>
<li>
<p>Add package repositories:</p>
<pre class="hljs"><code><div>curl -sL https://deb.nodesource.com/setup_10.x | sudo -E bash -
</div></code></pre>
</li>
<li>
<p>Update repositories:</p>
<pre class="hljs"><code><div>sudo apt-get update
</div></code></pre>
</li>
<li>
<p>Install dependencies:</p>
<pre class="hljs"><code><div>sudo apt install -y make git-all postgresql postgresql-contrib golang-go nodejs
npm install -g less
<span class="hljs-comment"># Watch out, it is not github.com/go-bindata/go-bindata!</span>
go get -u github.com/kevinburke/go-bindata/...
</div></code></pre>
</li>
<li>
<p>Configure startup services:</p>
<pre class="hljs"><code><div>sudo systemctl <span class="hljs-built_in">enable</span> postgresql
</div></code></pre>
</li>
</ol>
<h2 id="step-2-initialize-your-database">Step 2: Initialize your database</h2>
<p>You need a fresh Postgres database and a database user that has full ownership of that database.</p>
<ol>
<li>
<p>Create a database for the current Unix user:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># For Linux users, first access the postgres user shell</span>
sudo su - postgres
</div></code></pre>
<pre class="hljs"><code><div>createdb
</div></code></pre>
</li>
<li>
<p>Create the Gogs user and password:</p>
<pre class="hljs"><code><div>createuser --superuser gogs
psql -c <span class="hljs-string">"ALTER USER gogs WITH PASSWORD '&lt;YOUR PASSWORD HERE&gt;';"</span>
</div></code></pre>
</li>
<li>
<p>Create the Gogs database</p>
<pre class="hljs"><code><div>createdb --owner=gogs --encoding=UTF8 --template=template0 gogs
</div></code></pre>
</li>
</ol>
<h2 id="step-3-get-the-code">Step 3: Get the code</h2>
<p>Generally, you don't need a full clone, so set <code>--depth</code> to <code>10</code>:</p>
<pre class="hljs"><code><div>git <span class="hljs-built_in">clone</span> --depth 10 https://github.com/gogs/gogs.git
</div></code></pre>
<p><strong>NOTE</strong> The repository has Go Modules enabled, please clone to somewhere outside of your <code>$GOPATH</code>.</p>
<h2 id="step-4-configure-database-settings">Step 4: Configure database settings</h2>
<p>Create a <code>custom/conf/app.ini</code> file inside the repository and put the following configuration (everything under <code>custom/</code> directory is used to override default files and is excluded by <code>.gitignore</code>):</p>
<pre class="hljs"><code><div><span class="hljs-section">[database]</span>
<span class="hljs-attr">DB_TYPE</span> = postgres
<span class="hljs-attr">HOST</span> = <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">5432</span>
<span class="hljs-attr">NAME</span> = gogs
<span class="hljs-attr">USER</span> = gogs
<span class="hljs-attr">PASSWD</span> = &lt;YOUR PASSWORD HERE&gt;
<span class="hljs-attr">SSL_MODE</span> = disable
</div></code></pre>
<h2 id="step-5-start-the-server">Step 5: Start the server</h2>
<pre class="hljs"><code><div>make web
</div></code></pre>
<p>You would have to re-run this command after changing Go files, or any file under <code>conf/</code>, <code>template/</code> and <code>public/</code> directories.</p>
<h2 id="other-nice-things">Other nice things</h2>
<h3 id="load-html-templates-and-static-files-from-disk">Load HTML templates and static files from disk</h3>
<p>When you are actively working on HTML templates and static files during development, you may want to enable the following configuration to avoid recompiling and restarting Gogs every time you make a change to files under <code>template/</code> and <code>public/</code> directories:</p>
<pre class="hljs"><code><div><span class="hljs-section">[server]</span>
<span class="hljs-attr">LOAD_ASSETS_FROM_DISK</span> = <span class="hljs-literal">true</span>
</div></code></pre>
<h3 id="offline-development">Offline development</h3>
<p>Sometimes you will want to develop Gogs but it just so happens you will be on a plane or a train or perhaps a beach, and you will have no WiFi. And you may raise your fist toward heaven and say something like, &quot;Why, we can put a man on the moon, so why can't we develop high-quality Git hosting without an Internet connection?&quot; But lower your hand back to your keyboard and fret no further, for the year is 2020, and you <em>can</em> develop Gogs with no connectivity by setting the following configuration in your <code>custom/conf/app.ini</code>:</p>
<pre class="hljs"><code><div><span class="hljs-section">[server]</span>
<span class="hljs-attr">OFFLINE_MODE</span> = <span class="hljs-literal">true</span>
</div></code></pre>

</body>
</html>
